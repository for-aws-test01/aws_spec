# AWSomeShop 任务分解文档 v3.0

## 文档信息

- **项目名称**: AWSomeShop 内部员工福利电商系统
- **文档版本**: 3.0 (超级简化版)
- **创建日期**: 2026-01-14
- **更新日期**: 2026-01-14
- **文档状态**: 待审批
- **基于文档**: requirements.md v3.0, design.md v3.0

**版本更新说明**:
- v3.0 (2026-01-14): 超级简化版，删除35个任务，工作量减少70%

## 1. 任务概述

本文档将 AWSomeShop 项目拆分为 **34 个**可执行的开发任务，分为 **9 个阶段**。

## 2. 任务优先级定义

- **P0**: 阻塞性任务，必须最先完成
- **P1**: 高优先级，核心功能
- **P2**: 中优先级，重要功能

## 3. 工作量估算单位

- **XS**: 0.5 天
- **S**: 1 天
- **M**: 2 天
- **L**: 3 天

## 4. 删除的功能（v3.0）

### 已删除任务（35个，约45-50天）
1. ❌ TASK-006: 实现日志模块（2天）
2. ❌ TASK-011: 实现修改密码 API（1天）
3. ❌ TASK-015: 实现员工详情查询 API（0.5天）
4. ❌ TASK-016: 实现更新员工信息 API（1天）
5. ❌ TASK-017: 实现重置员工密码 API（1天）
6. ❌ TASK-018: 实现创建管理员 API（1天）
7. ❌ TASK-019: 实现图片上传功能（2天）
8. ❌ TASK-020: 实现图片访问 API（1天）
9. ❌ TASK-024: 实现产品详情查询 API（0.5天）
10. ❌ TASK-025: 实现更新产品 API（2天）
11. ❌ TASK-026: 实现删除产品 API（1天）
12. ❌ TASK-027: 实现产品上架/下架 API（1天）
13. ❌ TASK-029: 实现积分日志查询 API（员工）（1天）
14. ❌ TASK-030: 实现积分日志查询 API（管理员）（1天）
15. ❌ TASK-032: 实现批量发放积分 API（2天）
16. ❌ TASK-033: 实现扣除积分 API（2天）
17. ❌ TASK-037: 实现订单详情查询 API（员工）（0.5天）
18. ❌ TASK-038: 实现取消订单 API（2天）
19. ❌ TASK-041: 实现拒绝订单 API（2天）
20. ❌ TASK-042: 实现系统概况 API（2天）
21. ❌ TASK-043: 实现个人信息查询 API（0.5天）
22. ❌ TASK-055: 实现个人信息页（1天）
23. ❌ TASK-056: 实现积分余额页（2天）
24. ❌ TASK-058: 实现订单详情页（1天）
25. ❌ TASK-059: 实现修改密码页（1天）
26. ❌ TASK-060: 实现系统概况页（2天）
27. ❌ TASK-063: 实现员工详情/编辑页（2天）
28. ❌ TASK-066: 实现产品详情/编辑页（管理员）（2天）
29. ❌ TASK-068: 实现积分日志页（管理员）（2天）
30. ❌ TASK-070: 实现订单详情页（管理员）（2天）
31. ❌ TASK-071~075: 所有单元测试（10天）
32. ❌ TASK-078: 配置 Docker Compose（2天）
33. ❌ TASK-080: 编写 API 文档（2天）
34. ❌ TASK-083: 性能测试（2天）
35. ❌ 审计日志相关代码

## 5. 任务列表

---

## 阶段一：项目初始化 (3 任务，3天)

### TASK-001: 创建项目结构
**优先级**: P0  
**工作量**: S (1天)  
**状态**: ✅ 已完成
**依赖**: 无  
**负责模块**: 基础设施

**任务描述**: 创建前后端项目的目录结构，初始化 Git 仓库。

**验收标准**:
- [x] 创建根目录和子目录
- [x] 初始化 Git 仓库
- [x] 创建配置文件

---

### TASK-002: 配置开发环境
**优先级**: P0  
**工作量**: S (1天)  
**状态**: ✅ 已完成
**依赖**: TASK-001  
**负责模块**: 基础设施

**任务描述**: 配置后端和前端的开发环境，安装必要的依赖。

**验收标准**:
- [x] 后端安装 Go 依赖
- [x] 前端安装 npm 依赖
- [x] 创建配置文件

---

### TASK-003: 设置数据库
**优先级**: P0  
**工作量**: S (1天)  
**状态**: ✅ 已完成
**依赖**: TASK-001  
**负责模块**: 数据库

**任务描述**: 创建数据库和表结构，执行初始化脚本。

**验收标准**:
- [x] 创建数据库
- [x] 编写 schema.sql（4个表：users, products, orders, point_logs）
- [x] 编写 seed.sql
- [ ] 执行迁移脚本

**技术要点**:
- 删除 audit_logs 和 app_logs 表
- users 表不需要 status 字段
- products 表不需要 status 和 is_deleted 字段
- orders 表只保留 pending 和 approved 状态
- point_logs 表只保留 3 种类型：onboarding, admin_grant, redeem

---

## 阶段二：后端基础设施 (4 任务，5.5天)

### TASK-004: 实现数据库连接和配置管理
**优先级**: P0  
**工作量**: S (1天)  
**状态**: ✅ 已完成
**依赖**: TASK-002, TASK-003  
**负责模块**: 基础设施

**任务描述**: 实现数据库连接池和环境变量配置管理。

**验收标准**:
- [x] 实现数据库连接
- [x] 实现配置管理
- [x] 实现连接池
- [x] 实现优雅关闭

---

### TASK-005: 实现统一响应格式和错误处理
**优先级**: P0  
**工作量**: S (1天)  
**状态**: ✅ 已完成
**依赖**: TASK-004  
**负责模块**: 基础设施

**任务描述**: 实现统一的 API 响应格式和错误码定义。

**验收标准**:
- [x] 实现响应格式
- [x] 实现错误码定义
- [x] 实现响应函数

---

### TASK-006: 实现 JWT 认证中间件
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-005  
**负责模块**: 认证

**任务描述**: 实现 JWT Token 生成、验证和认证中间件。

**验收标准**:
- [ ] 实现 JWT 中间件
- [ ] 实现 Token 生成函数
- [ ] 实现 Token 验证函数
- [ ] 实现权限检查（员工/管理员）
- [ ] 实现 Cookie 设置和读取
- [ ] 处理 Token 过期

---

### TASK-007: 实现 CORS 中间件
**优先级**: P0  
**工作量**: XS (0.5天)  
**依赖**: TASK-004  
**负责模块**: 基础设施

**任务描述**: 配置 CORS 中间件，允许前端跨域访问。

**验收标准**:
- [ ] 配置 CORS 允许的源
- [ ] 配置允许的 HTTP 方法
- [ ] 启用 Credentials

---

## 阶段三：用户认证模块 (2 任务，2.5天)

### TASK-008: 实现用户登录 API
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-006  
**负责模块**: 认证

**任务描述**: 实现用户登录功能，支持员工和管理员登录。

**验收标准**:
- [ ] 实现 POST /api/auth/login 接口
- [ ] 验证工号和密码
- [ ] 生成 JWT Token
- [ ] 设置 Cookie
- [ ] 返回用户信息

---

### TASK-009: 实现用户登出 API
**优先级**: P1  
**工作量**: XS (0.5天)  
**依赖**: TASK-008  
**负责模块**: 认证

**任务描述**: 实现用户登出功能，清除 Cookie。

**验收标准**:
- [ ] 实现 POST /api/auth/logout 接口
- [ ] 清除 Cookie
- [ ] 返回成功响应

---

## 阶段四：用户管理模块 (3 任务，4天)

### TASK-010: 实现工号生成算法
**优先级**: P0  
**工作量**: S (1天)  
**依赖**: TASK-004  
**负责模块**: 用户管理

**任务描述**: 实现自动生成工号的算法。

**验收标准**:
- [ ] 实现工号生成函数
- [ ] 格式：YYYYMMDD-NNN
- [ ] 每天从 001 开始
- [ ] 检查当天是否达到 999 上限

---

### TASK-011: 实现创建员工 API
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-010  
**负责模块**: 用户管理

**任务描述**: 实现管理员创建员工账号功能。

**验收标准**:
- [ ] 实现 POST /api/admin/employees 接口
- [ ] 自动生成工号
- [ ] 密码使用 bcrypt 哈希
- [ ] 自动发放 1000 积分
- [ ] 记录积分日志（入职发放）
- [ ] 使用事务保证数据一致性
- [ ] 返回员工信息

---

### TASK-012: 实现员工列表查询 API
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-011  
**负责模块**: 用户管理

**任务描述**: 实现管理员查询员工列表功能。

**验收标准**:
- [ ] 实现 GET /api/admin/employees 接口
- [ ] 支持分页（page, page_size）
- [ ] 返回分页数据

---

## 阶段五：产品管理模块 (4 任务，5天)

### TASK-013: 实现创建产品 API
**优先级**: P0  
**工作量**: S (1天)  
**依赖**: TASK-008  
**负责模块**: 产品管理

**任务描述**: 实现管理员创建产品功能（使用图片URL）。

**验收标准**:
- [ ] 实现 POST /api/admin/products 接口
- [ ] 处理 JSON 请求体
- [ ] 接收图片 URL（不上传文件）
- [ ] 创建产品记录
- [ ] 返回产品信息

**技术要点**:
- 不需要处理文件上传
- 图片URL为外部链接

---

### TASK-014: 实现产品列表查询 API（管理员）
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-013  
**负责模块**: 产品管理

**任务描述**: 实现管理员查询产品列表功能。

**验收标准**:
- [ ] 实现 GET /api/admin/products 接口
- [ ] 支持分页
- [ ] 按创建时间倒序排列
- [ ] 返回分页数据

---

### TASK-015: 实现产品列表查询 API（员工）
**优先级**: P0  
**工作量**: S (1天)  
**依赖**: TASK-013  
**负责模块**: 产品管理

**任务描述**: 实现员工查询产品列表功能。

**验收标准**:
- [ ] 实现 GET /api/products 接口
- [ ] 支持分页
- [ ] 按创建时间倒序排列
- [ ] 返回分页数据

---

### TASK-016: 实现产品详情查询 API
**优先级**: P1  
**工作量**: M (2天)  
**依赖**: TASK-013  
**负责模块**: 产品管理

**任务描述**: 实现产品详情查询功能（包含兑换功能）。

**验收标准**:
- [ ] 实现 GET /api/products/:id 接口
- [ ] 返回产品完整信息
- [ ] 员工和管理员都可访问
- [ ] 处理产品不存在的情况

---

## 阶段六：积分管理模块 (2 任务，2.5天)

### TASK-017: 实现积分余额查询 API（员工）
**优先级**: P1  
**工作量**: XS (0.5天)  
**依赖**: TASK-011  
**负责模块**: 积分管理

**任务描述**: 实现员工查询个人积分余额功能。

**验收标准**:
- [ ] 实现 GET /api/points/balance 接口
- [ ] 从 JWT 获取当前用户
- [ ] 返回积分余额和用户信息

---

### TASK-018: 实现发放积分 API
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-011  
**负责模块**: 积分管理

**任务描述**: 实现管理员发放积分功能。

**验收标准**:
- [ ] 实现 POST /api/admin/points/grant 接口
- [ ] 增加用户积分
- [ ] 记录积分日志（类型：admin_grant）
- [ ] 使用事务保证数据一致性
- [ ] 返回新积分余额

---

## 阶段七：订单管理模块 (4 任务，7.5天)

### TASK-019: 实现订单号生成算法
**优先级**: P0  
**工作量**: XS (0.5天)  
**依赖**: TASK-004  
**负责模块**: 订单管理

**任务描述**: 实现自动生成订单号的算法。

**验收标准**:
- [ ] 实现订单号生成函数
- [ ] 格式：YYYYMMDDHHmmss-XXXXXX
- [ ] 随机字符为大写字母+数字

---

### TASK-020: 实现兑换产品 API
**优先级**: P0  
**工作量**: L (3天)  
**依赖**: TASK-019, TASK-015  
**负责模块**: 订单管理

**任务描述**: 实现员工兑换产品功能，使用事务保证数据一致性。

**验收标准**:
- [ ] 实现 POST /api/orders/redeem 接口
- [ ] 验证产品是否存在
- [ ] 验证用户积分是否充足
- [ ] 生成订单号
- [ ] 创建产品快照（JSON）
- [ ] 扣除用户积分
- [ ] 创建订单（状态：pending）
- [ ] 记录积分日志（类型：redeem）
- [ ] 使用事务保证原子性
- [ ] 返回订单信息和新积分余额

---

### TASK-021: 实现订单列表查询 API（员工）
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-020  
**负责模块**: 订单管理

**任务描述**: 实现员工查询个人订单列表功能。

**验收标准**:
- [ ] 实现 GET /api/orders 接口
- [ ] 只返回当前用户的订单
- [ ] 支持分页
- [ ] 按申请时间倒序排列
- [ ] 返回产品快照信息

---

### TASK-022: 实现订单列表查询和核销 API（管理员）
**优先级**: P1  
**工作量**: L (3天)  
**依赖**: TASK-020  
**负责模块**: 订单管理

**任务描述**: 实现管理员查询所有订单列表和核销功能。

**验收标准**:
- [ ] 实现 GET /api/admin/orders 接口
- [ ] 返回所有订单
- [ ] 支持分页
- [ ] 关联用户和产品信息
- [ ] 按申请时间倒序排列
- [ ] 实现 PUT /api/admin/orders/:id/approve 接口
- [ ] 验证订单状态为 pending
- [ ] 更新订单状态为 approved
- [ ] 记录审核时间和审核人

---

## 阶段八：前端基础设施 (6 任务，9天)

### TASK-023: 配置 Webpack 构建
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-002  
**负责模块**: 前端基础

**任务描述**: 配置 Webpack 构建流程。

**验收标准**:
- [ ] 配置 webpack.config.js
- [ ] 配置 Babel 转译
- [ ] 配置 CSS 加载
- [ ] 配置开发服务器
- [ ] 测试构建成功

---

### TASK-024: 配置 Express 服务器
**优先级**: P0  
**工作量**: S (1天)  
**依赖**: TASK-023  
**负责模块**: 前端基础

**任务描述**: 配置 Express 服务器托管静态文件。

**验收标准**:
- [ ] 创建 server.js
- [ ] 托管 dist 目录
- [ ] 配置 History 路由支持
- [ ] 监听 8000 端口

---

### TASK-025: 实现路由管理
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-024  
**负责模块**: 前端基础

**任务描述**: 实现前端路由管理器。

**验收标准**:
- [ ] 创建 router.js
- [ ] 实现路由注册
- [ ] 实现路由导航
- [ ] 使用 History API
- [ ] 支持路由参数

---

### TASK-026: 实现 API 调用封装
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-007  
**负责模块**: 前端基础

**任务描述**: 封装 API 调用方法。

**验收标准**:
- [ ] 创建 api.js
- [ ] 实现 API 类
- [ ] 封装 GET/POST/PUT/DELETE 方法
- [ ] 配置 credentials: 'include'
- [ ] 处理响应和错误

---

### TASK-027: 实现认证逻辑
**优先级**: P0  
**工作量**: S (1天)  
**依赖**: TASK-026  
**负责模块**: 前端基础

**任务描述**: 实现前端认证逻辑。

**验收标准**:
- [ ] 创建 auth.js
- [ ] 实现登录函数
- [ ] 实现登出函数
- [ ] 实现获取当前用户函数
- [ ] 使用 localStorage 存储用户信息

---

### TASK-028: 实现导航栏组件
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-025, TASK-027  
**负责模块**: 前端组件

**任务描述**: 实现顶部导航栏组件。

**验收标准**:
- [ ] 创建 navbar.js
- [ ] 实现导航菜单
- [ ] 显示用户信息和积分余额
- [ ] 实现登出按钮
- [ ] 根据角色显示不同菜单

---

## 阶段九：前端页面开发 (6 任务，10天)

### TASK-029: 实现登录页
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-027  
**负责模块**: 前端页面

**任务描述**: 实现员工和管理员登录页面。

**验收标准**:
- [ ] 创建登录页面 HTML
- [ ] 实现表单验证
- [ ] 调用登录 API
- [ ] 保存用户信息到 localStorage
- [ ] 根据角色跳转（员工→产品列表，管理员→订单列表）
- [ ] 显示错误提示

---

### TASK-030: 实现产品列表页（员工）
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-028  
**负责模块**: 前端页面

**任务描述**: 实现员工端产品列表页（首页）。

**验收标准**:
- [ ] 调用产品列表 API
- [ ] 卡片网格布局显示产品
- [ ] 显示产品图片、名称、积分
- [ ] 实现分页
- [ ] 点击卡片跳转到详情页

---

### TASK-031: 实现产品详情页（员工）
**优先级**: P0  
**工作量**: M (2天)  
**依赖**: TASK-030  
**负责模块**: 前端页面

**任务描述**: 实现员工端产品详情页。

**验收标准**:
- [ ] 调用产品详情 API
- [ ] 显示产品完整信息
- [ ] 显示当前积分余额
- [ ] 实现兑换按钮
- [ ] 根据积分禁用按钮
- [ ] 调用兑换 API
- [ ] 显示成功/错误提示

---

### TASK-032: 实现订单列表页（员工）
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-028  
**负责模块**: 前端页面

**任务描述**: 实现员工订单列表页。

**验收标准**:
- [ ] 调用订单列表 API
- [ ] 表格显示订单列表
- [ ] 显示产品信息、积分、状态
- [ ] 实现分页

---

### TASK-033: 实现员工列表和创建页（管理员）
**优先级**: P1  
**工作量**: M (2天)  
**依赖**: TASK-028  
**负责模块**: 前端页面

**任务描述**: 实现管理员员工列表和创建页。

**验收标准**:
- [ ] 调用员工列表 API
- [ ] 表格显示员工列表
- [ ] 实现分页
- [ ] 实现创建员工表单
- [ ] 调用创建员工 API
- [ ] 显示成功/错误提示

---

### TASK-034: 实现产品列表和创建页（管理员）
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-028  
**负责模块**: 前端页面

**任务描述**: 实现管理员产品列表和创建页。

**验收标准**:
- [ ] 调用产品列表 API（管理员）
- [ ] 表格显示产品列表
- [ ] 实现分页
- [ ] 实现创建产品表单（输入图片URL）
- [ ] 调用创建产品 API
- [ ] 显示成功/错误提示

---

### TASK-035: 实现发放积分页（管理员）
**优先级**: P1  
**工作量**: S (1天)  
**依赖**: TASK-028  
**负责模块**: 前端页面

**任务描述**: 实现管理员发放积分页。

**验收标准**:
- [ ] 实现单个发放表单
- [ ] 实现表单验证
- [ ] 调用发放积分 API
- [ ] 显示成功/错误提示

---

### TASK-036: 实现订单列表页（管理员）
**优先级**: P1  
**工作量**: M (2天)  
**依赖**: TASK-028  
**负责模块**: 前端页面

**任务描述**: 实现管理员订单列表页。

**验收标准**:
- [ ] 调用订单列表 API（管理员）
- [ ] 表格显示订单列表
- [ ] 显示订单号、员工、产品、状态
- [ ] 实现分页
- [ ] 实现核销按钮（直接在列表操作）
- [ ] 调用核销 API

---

## 6. 工作量统计

| 阶段 | 任务数 | 总工作量（天） |
|------|--------|----------------|
| 阶段一：项目初始化 | 3 | 3 |
| 阶段二：后端基础设施 | 4 | 5.5 |
| 阶段三：用户认证模块 | 2 | 2.5 |
| 阶段四：用户管理模块 | 3 | 4 |
| 阶段五：产品管理模块 | 4 | 5 |
| 阶段六：积分管理模块 | 2 | 2.5 |
| 阶段七：订单管理模块 | 4 | 7.5 |
| 阶段八：前端基础设施 | 6 | 9 |
| 阶段九：前端页面开发 | 6 | 10 |
| **总计** | **34** | **49** |

**预估总工期**: 约 10 周（按每周 5 个工作日计算）

## 7. 版本对比

| 版本 | 任务数 | 工作量（天） | 减少比例 |
|------|--------|--------------|----------|
| v1.0 原始版 | 85 | 141 | - |
| v2.0 激进简化 | 69 | 50 | 65% |
| v3.0 超级简化 | 34 | 49 | 70% |

**v3.0 相比 v1.0**:
- 删除任务：51个
- 节省时间：92天
- 工作量减少：70%

**v3.0 相比 v2.0**:
- 删除任务：35个
- 节省时间：约1天（主要是删除复杂功能）
- 保留核心功能

---

## 8. 关键路径

关键路径（最长依赖链）：
```
TASK-001 → TASK-002 → TASK-004 → TASK-005 → TASK-006 → TASK-008 → 
TASK-010 → TASK-011 → TASK-013 → TASK-015 → TASK-019 → TASK-020 → 
TASK-023 → TASK-024 → TASK-025 → TASK-026 → TASK-027 → TASK-028 → 
TASK-029 → TASK-030 → TASK-031
```

**关键路径工作量**: 约 35 天

## 9. 核心功能保留

### 员工端（4个页面）
1. ✅ 登录页
2. ✅ 产品列表页（首页）
3. ✅ 产品详情页（兑换）
4. ✅ 订单列表页

### 管理员端（5个页面）
1. ✅ 登录页
2. ✅ 员工列表页 + 创建员工
3. ✅ 产品列表页 + 创建产品
4. ✅ 订单列表页（直接核销）
5. ✅ 发放积分页

### 后端 API（15个接口）
1. ✅ POST /api/auth/login - 登录
2. ✅ POST /api/auth/logout - 登出
3. ✅ POST /api/admin/employees - 创建员工
4. ✅ GET /api/admin/employees - 员工列表
5. ✅ POST /api/admin/products - 创建产品
6. ✅ GET /api/admin/products - 产品列表（管理员）
7. ✅ GET /api/products - 产品列表（员工）
8. ✅ GET /api/products/:id - 产品详情
9. ✅ GET /api/points/balance - 积分余额
10. ✅ POST /api/admin/points/grant - 发放积分
11. ✅ POST /api/orders/redeem - 兑换产品
12. ✅ GET /api/orders - 订单列表（员工）
13. ✅ GET /api/admin/orders - 订单列表（管理员）
14. ✅ PUT /api/admin/orders/:id/approve - 核销订单

### 数据库（4个表）
1. ✅ users - 用户表（员工+管理员）
2. ✅ products - 产品表
3. ✅ orders - 订单表
4. ✅ point_logs - 积分日志表

## 10. 审批记录

| 角色 | 姓名 | 审批状态 | 审批日期 | 备注 |
|------|------|----------|----------|------|
| 技术负责人 | | 待审批 | | v3.0 超级简化版 |
| 项目经理 | | 待审批 | | |
| 产品经理 | | 待审批 | | |

---

**文档结束**
